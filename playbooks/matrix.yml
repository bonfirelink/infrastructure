---
- hosts: matrix.bonfire.link
  become: true
  roles:
    - common
    - fail2ban
    - certbot
    - nginx
    - matrix
  vars:
    - allowed_ports:
        - "8448"  # Matrix federation
    - certbot_certs:
        - domains:
            - matrix.bonfire.link
    - nginx_vhosts:
        - server_name: "matrix.bonfire.link"
          ssl_enabled: true
          extra_parameters: >
            location / {
              proxy_pass http://127.0.0.1:8008;
              proxy_set_header X-Forwarded-For $remote_addr;
              client_max_body_size 10M;
            }
    - synapse_server_name: bonfire.link
    - synapse_server_fqdn: matrix.bonfire.link
    - synapse_with_postgresql: true
    - synapse_psql_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36336164613163376436636435356136353361616565333035386533633661306639366530366437
          6466343235643561303933333363663835633561323864340a316266623139383530373436643336
          61373639663365626262323134356563653536353036623936313234636166346532373736643633
          6465306563303361380a646464366161386230613761663630646464373536643037326238643839
          3430
    - discord_bridge_client_id: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34326539633836323633303437383630643032386138303265373634633135373262626530626465
          3131636165356230393662383137666332343734323365370a393562656431393565666236653238
          31353030623639643338633536316663666666353830633537646664363562316431323336623065
          3661393833656565660a646363666262656330653138383634653061353536643563306137633365
          35323235306232386430333661346230333938663564353236386431343739323362
    - discord_bridge_bot_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37333864613765663061386438623263383030623238663030633237363030626138373964376563
          6337613431633936393435376534646230356162376561620a366238373564363266306337343530
          62663334316235663434383134326131333638323137656663303038646533316364623636343136
          6134313736666637610a303636386166656561323338643035346232636230373765396465363263
          35393831353438646330666163326537303338656262356335393133633965393662346463303832
          36663162636630366234343062653836356365356363313238303235613034366562643137353330
          633162626433353430336166653933623730
